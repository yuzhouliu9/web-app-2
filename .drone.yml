---
kind: pipeline
type: kubernetes
name: default

steps:
steps:
- name: publish
  image: plugins/kaniko-ecr
  settings:
    create_repository: true
    registry: 795250896452.dkr.ecr.us-east-1.amazonaws.com
    repo: devops/${DRONE_REPO_NAME}
    tags:
    - git-${DRONE_COMMIT_SHA:0:7}
    - ${DRONE_TAG}
    - latest
    access_key:
      from_secret: ecr_access_key
    secret_key:
      from_secret: ecr_secret_key
  when:
    event:
    - push
    - tag

- name: triggered-by-a
  image: python:3.4
  commands:
  - python --version
  when:
    paths:
      include:
        - folder_a/**
    branch:
      - main
    event:
      - push

- name: triggered-by-b
  image: python:3.4
  commands:
  - python --version
  when:
    paths:
      include:
        - folder_b/**
    branch:
      - main
    event:
      - push

- name: triggered-by-everything-else
  image: python:3.4
  commands:
  - python --version
  when:
    paths:
      exclude:
        - folder_a/**
        - folder_b/**
    branch:
      - main
    event:
      - push
